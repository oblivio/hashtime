function HashTime(t,e){this.hashPrefix="/",this.renderedTPL="",this.landinghash="",this.lasthash=[],this.currenthash="",this.landingHTMLPage="",this.URLParameters=[],this.URLQuery="",this.titledata={},this.templatedata={},this.template=null,this.sharedtemplatedata={},this.partials=[],this.imagesToPreload=[],this.onDOMReady=function(){console.log("nothing set for DOM ready")}}HashTime.prototype._init=function(){var t=this;if(t.setLanding(),0==window.location.hash.length){var e=String(t.landingHTMLPage).replace(".html","");""==e&&(e="index"),window.location.hash=HT.hashPrefix+e,t.landinghash=window.location.hash,t.currenthash=window.location.hash}else{var a=String(window.location.hash).split("?"),n=a[0];n=String(n).replace("#","");var o="",i=!1;if("undefined"!=typeof a[1]&&(o=a[1],i=!0),i)return location.href=t.landingHTMLPage+"?"+o+HT.hashPrefix+n,!1;console.log("clean hash",n),n==t.hashPrefix&&(n=t.hashPrefix+"index"),t.landinghash=n,t.currenthash=n,window.location.hash=n}t.URLParameters=t._GET(),t.URLQuery=t._query()},HashTime.prototype.init=function(){var t=this;t.setAppTemplate(),window.location.hash=t.landinghash,t.render()},HashTime.prototype._GET=function(t){var e=this,a=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+(location.search?location.search:""),n=[];if(0==e.URLParameters.length){var o={};String(a).replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(t,e,a){o[e]=void 0!==a?a:""}),n=o}else n=e.URLParameters;return t?n[t]?n[t]:null:n},HashTime.prototype.imagePreload=function(){for(var t=this,e=t.imagesToPreload,a=0;a<e.length;a++)console.log("preloading image",e[a]),(new Image).src=e[a]},HashTime.prototype.render=function(){window.scrollTo(0,0);var t=this,e=t.sharedtemplatedata,a="is-",n=t.currenthash,o=String(n).replace("#","");o=String(o).replace(t.hashPrefix,""),0==o.length&&(o=String(t.landingHTMLPage).replace(".html","")),"undefined"!=typeof t.templatedata[o]&&(console.log("HashTime.templatedata[nohash]",t.templatedata[o]),e=jQuery.extend({},t.sharedtemplatedata,t.templatedata[o]));var i=function(t){var e=a+t,n=e.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()});return n};e[i(o)]=!0,t._setPageTitle(),t.renderedTPL!=o&&$("body").html(t.template(e),function(){console.log("render!",e),t.renderedTPL=o,t.onDOMReady()})},HashTime.prototype._query=function(t){var e=this,a="?",n=[];return"undefined"!=typeof t&&(n=t),$.each(e.URLParameters,function(t,e){-1!==jQuery.inArray(t,n)||(a+=t+"="+e+"&")}),a},HashTime.prototype._query2array=function(){var t=this,e={};return console.log("MayflowerApp.URLQuery",t._query()),String(t._query()).replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(t,a,n){switch(a){default:e[a]=void 0!==n?n:""}}),e},HashTime.prototype.isTouchDevice=function(){return"ontouchstart"in window},HashTime.prototype._registerPartial=function(t){return t&&$("[data-template-name='"+t+"']").length>0?(Handlebars.registerPartial(t,$("[data-template-name='"+t+"']").html()),!0):!1},HashTime.prototype.setPreloadImages=function(t){var e=this;"[object Array]"===Object.prototype.toString.call(t)&&(e.imagesToPreload=t)},HashTime.prototype.setTitleData=function(t,e){var a=this;"undefined"==typeof a.titledata[t]&&(a.titledata[t]=""),a.titledata[t]=String(e)},HashTime.prototype.setTitleObj=function(t){var e=this;"object"==typeof t&&$.each(t,function(t,a){"undefined"==typeof e.titledata[t]&&(e.titledata[t]=""),e.titledata[t]=String(a)})},HashTime.prototype._setPageTitle=function(){var t=this,e="",a=String(t.currenthash).replace("#","");a=String(a).replace(t.hashPrefix,""),""==a&&(a="index"),"undefined"!=typeof t.titledata[a]&&(e=t.titledata[a]),document.title=e},HashTime.prototype.setTemplateData=function(t,e){var a=this;"object"==typeof t&&e?a.sharedtemplatedata=jQuery.extend(t,a.sharedtemplatedata):"object"==typeof t&&$.each(t,function(t,e){"undefined"==typeof a.templatedata[t]&&(a.templatedata[t]={}),$.each(e,function(e,n){a.templatedata[t][e]=n})})},HashTime.prototype.setPartials=function(t){var e=this,a=!0;if(console.log("arr",t),"[object Array]"===Object.prototype.toString.call(t))for(var n=0;n<t.length;n++){var o=t[n],i=e._registerPartial(o);if(!i){console.log("Failed to register partial! - Cannot proceed.",o),a=!1;break}e.partials.push(o)}else a=!1;return a},HashTime.prototype.setAppTemplate=function(){var t=this;if(null==t.template){if(console.log("setting template"),0==t.partials.length)return console.log("no partials"),!1;for(var e="{{#if ",a="is-",n=function(t){var e=a+t,n=e.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()});return n},o=0;o<t.partials.length;o++){var i=t.partials[o],r=n(i);0==o?(e+=r,e+="}}{{>"+i+"}}"):(e+="{{else if "+r+"}}",e+="{{>"+i+"}}")}e+="{{/if}}",console.log("hbIF",e);var s=e;return t.template=Handlebars.compile(s),!0}},HashTime.prototype.setLanding=function(){var t=this,e=location.pathname.substring(location.pathname.lastIndexOf("/")+1);t.landingHTMLPage=e},HashTime.prototype.navBack=function(){var t=this,e=t.lasthash.indexOf(window.location.hash);e&&(console.log("found route! now lets try to go back!",e,history),t.lasthash.splice(e,1)),window.location.hash=t.lasthash.pop()};var HT=!1;!function(t){var e=t.fn.html;t.fn.html=function(t,a){var n=e.apply(this,arguments);return"function"==typeof a&&a(),n},HT=new HashTime,HT.lasthash.push(window.location.hash),t(window).on("hashchange",function(t){console.log("lasthash",HT.lasthash),HT.lasthash.push(window.location.hash),HT.currenthash=window.location.hash;var e=String(window.location.hash).replace("#","");e=e.replace(HT.hashPrefix,""),-1!==jQuery.inArray(e,HT.partials)?HT.render():(console.log("partial not found - default to index"),window.location.hash="#"+HT.hashPrefix+"index")}),HT._init()}(jQuery,Handlebars);